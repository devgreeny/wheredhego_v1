<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ user.username }}'s Profile â€” Where'd He Go?</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323:wght@400&display=swap" rel="stylesheet">
  
  <!-- Favicon implementation -->
  <link rel="icon" href="/favicon/favicon.ico" sizes="32x32">
  <link rel="icon" href="/favicon/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <style>
    :root {
      --ink: #0f2e4d;
      --ink-2: #102a44;
      --bg: #f1e3c4;
      --bg-2: #e9d7af;
      --accent: #e44a3c;
      --accent-2: #ff7e4d;
      --cream: #ffe9b3;
      --card-1: #f29d5b;
      --card-2: #e78443;
      --bezel: #071a2f;
    }

    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      padding: 20px;
      color: var(--ink-2);
      font-family: "VT323", Consolas, "Courier New", monospace;
      background: 
        radial-gradient(1200px 480px at 50% -120px, #fff8e6 0, var(--bg) 60%, var(--bg) 100%),
        repeating-linear-gradient(to bottom, rgba(0,0,0,.03) 0 1px, transparent 1px 3px);
      min-height: 100vh;
    }

    .wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-family: "Press Start 2P";
      font-size: clamp(18px, 4vw, 32px);
      color: var(--ink);
      margin: 0 0 10px 0;
      text-shadow: 3px 3px 0 var(--accent);
    }

    .user-info {
      background: linear-gradient(180deg, var(--card-1), var(--card-2));
      border: 6px solid var(--ink);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 30px;
      text-align: center;
      box-shadow: 0 12px 0 #153a5e, 0 22px 38px rgba(0,0,0,.35);
    }

    .user-info h2 {
      font-family: "Press Start 2P";
      font-size: 16px;
      color: var(--ink);
      margin: 0 0 10px 0;
    }

    .user-info p {
      font-size: 18px;
      margin: 5px 0;
      color: var(--ink-2);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(180deg, var(--card-1), var(--card-2));
      border: 6px solid var(--ink);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 0 #153a5e, 0 16px 24px rgba(0,0,0,.25);
      transition: transform .12s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
    }

    .stat-card h3 {
      font-family: "Press Start 2P";
      font-size: 12px;
      color: var(--ink);
      margin: 0 0 15px 0;
      text-align: center;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 16px;
    }

    .stat-label {
      color: var(--ink-2);
    }

    .stat-value {
      color: var(--ink);
      font-weight: bold;
    }

    .recent-scores {
      background: linear-gradient(180deg, var(--card-1), var(--card-2));
      border: 6px solid var(--ink);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 0 #153a5e, 0 16px 24px rgba(0,0,0,.25);
    }

    .recent-scores h3 {
      font-family: "Press Start 2P";
      font-size: 14px;
      color: var(--ink);
      margin: 0 0 20px 0;
      text-align: center;
    }

    .score-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .score-item {
      display: grid;
      grid-template-columns: 80px 1fr 80px 120px;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 2px solid var(--ink-2);
      align-items: center;
      font-size: 14px;
    }

    .score-item:last-child {
      border-bottom: none;
    }

    .score-game {
      font-family: "Press Start 2P";
      font-size: 8px;
      color: var(--ink);
    }

    .score-quiz {
      color: var(--ink-2);
      font-size: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .score-points {
      color: var(--ink);
      font-weight: bold;
      text-align: center;
    }

    .score-date {
      color: var(--ink-2);
      font-size: 12px;
      text-align: right;
    }

    .nav-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .nav-link {
      background: linear-gradient(180deg, #ff6b58, var(--accent));
      border: 3px solid var(--ink);
      color: var(--cream);
      padding: 12px 20px;
      border-radius: 12px;
      text-decoration: none;
      font-family: "Press Start 2P";
      font-size: 10px;
      box-shadow: 0 6px 0 #9a231c;
      transition: all 0.2s ease;
      display: inline-block;
    }

    .nav-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 0 #9a231c;
      color: var(--cream);
    }

    .nav-link:active {
      transform: translateY(2px);
      box-shadow: 0 4px 0 #9a231c;
    }

    .empty-state {
      text-align: center;
      color: var(--ink-2);
      font-style: italic;
      padding: 40px 20px;
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .score-item {
        grid-template-columns: 1fr;
        gap: 5px;
        text-align: center;
      }
      
      .nav-links {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <!-- Include unified auth navigation bar -->
  {% include '_auth_navbar.html' %}
  
  <div class="wrapper">
    <!-- Header -->
    <div class="header">
      <h1>Player Profile</h1>
    </div>

    <!-- User Info -->
    <div class="user-info">
      <h2>{{ user.username }}</h2>
      <p>{{ user.email }}</p>
    </div>

    <!-- Game Stats -->
    <div class="stats-grid">
      {% for stat in stats %}
      <div class="stat-card">
        <h3>{{ stat.game_type.upper().replace('_', ' ') }}</h3>
        <div class="stat-item">
          <span class="stat-label">Games Played:</span>
          <span class="stat-value">{{ stat.total_games }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Average Score:</span>
          <span class="stat-value">{{ "%.1f"|format(stat.avg_score) }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Best Score:</span>
          <span class="stat-value">{{ stat.best_score }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Total Points:</span>
          <span class="stat-value">{{ stat.total_points }}</span>
        </div>
      </div>
      {% endfor %}
      
      {% if not stats %}
      <div class="stat-card">
        <div class="empty-state">
          <p>No game stats yet!</p>
          <p>Start playing to track your progress.</p>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Recent Scores -->
    <div class="recent-scores">
      <h3>Recent Game History</h3>
      {% if recent_scores %}
      <div class="score-list">
        {% for score in recent_scores %}
        <div class="score-item">
          <div class="score-game">{{ score.game_type.replace('_', ' ').upper() }}</div>
          <div class="score-quiz">{{ score.quiz_id[:30] }}{% if score.quiz_id|length > 30 %}...{% endif %}</div>
          <div class="score-points">{{ score.score }}/{{ score.max_points or '?' }}</div>
          <div class="score-date">{{ score.created_at.strftime('%m/%d/%y') }}</div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <p>No scores recorded yet!</p>
        <p>Play some games to see your history here.</p>
      </div>
      {% endif %}
    </div>

    <!-- Navigation -->
    <div class="nav-links">
      <a href="{{ url_for('home') }}" class="nav-link">Home</a>
      <a href="{{ url_for('starting5.show_quiz') }}" class="nav-link">Starting5</a>
      <a href="{{ url_for('gridiron11.show_quiz') }}" class="nav-link">Gridiron11</a>
      <!-- Creator poll temporarily disabled -->
      <!-- <a href="{{ url_for('creatorpoll.home') }}" class="nav-link">Creator Poll</a> -->
      <a href="{{ url_for('auth.logout') }}" class="nav-link">Logout</a>
    </div>
  </div>
</body>
</html>