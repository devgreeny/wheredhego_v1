<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ user.username }}'s Scores ‚Äî Where'd He Go?</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323:wght@400&display=swap" rel="stylesheet">
  
  <!-- Favicon implementation -->
  <link rel="icon" href="/favicon/favicon.ico" sizes="32x32">
  <link rel="icon" href="/favicon/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <style>
    :root {
      --ink: #0f2e4d;
      --ink-2: #102a44;
      --bg: #f1e3c4;
      --bg-2: #e9d7af;
      --accent: #e44a3c;
      --accent-2: #ff7e4d;
      --cream: #ffe9b3;
      --card-1: #f29d5b;
      --card-2: #e78443;
      --bezel: #071a2f;
      --navy: #0D3B66;
      --orange: #F95738;
      --yellow: #F4D35E;
      --cream-light: #FAF0CA;
    }

    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      padding: 20px;
      color: var(--ink-2);
      font-family: "VT323", Consolas, "Courier New", monospace;
      background: 
        radial-gradient(1200px 480px at 50% -120px, #fff8e6 0, var(--bg) 60%, var(--bg) 100%),
        repeating-linear-gradient(to bottom, rgba(0,0,0,.03) 0 1px, transparent 1px 3px);
      min-height: 100vh;
    }

    .wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-family: "Press Start 2P", monospace;
      font-size: 24px;
      color: var(--accent);
      margin: 0 0 10px 0;
      text-shadow: 2px 2px 0 var(--ink);
    }

    .header p {
      font-size: 18px;
      color: var(--ink-2);
      margin: 0;
    }

    .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--card-1), var(--card-2));
      border: 4px solid var(--ink);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: 4px 4px 0 var(--ink);
    }

    .stat-card h3 {
      font-family: "Press Start 2P", monospace;
      font-size: 12px;
      color: var(--ink);
      margin: 0 0 10px 0;
    }

    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: var(--ink);
      margin: 0 0 5px 0;
    }

    .stat-label {
      font-size: 14px;
      color: var(--ink-2);
      margin: 0;
    }

    .game-sections {
      display: flex;
      flex-direction: column;
      gap: 40px;
    }

    .game-section {
      background: rgba(255, 255, 255, 0.8);
      border: 3px solid var(--ink);
      border-radius: 12px;
      padding: 30px;
      box-shadow: 3px 3px 0 var(--ink-2);
    }

    .game-title {
      font-family: "Press Start 2P", monospace;
      font-size: 16px;
      color: var(--accent);
      margin: 0 0 20px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .game-icon {
      font-size: 20px;
    }

    .scores-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .scores-table th,
    .scores-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 2px solid var(--ink-2);
      font-size: 14px;
    }

    .scores-table th {
      background: var(--navy);
      color: var(--cream-light);
      font-family: "Press Start 2P", monospace;
      font-size: 10px;
      text-transform: uppercase;
    }

    .scores-table tr:hover {
      background: rgba(249, 87, 56, 0.1);
    }

    .score-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 12px;
    }

    .score-excellent {
      background: #22c55e;
      color: white;
    }

    .score-good {
      background: #eab308;
      color: white;
    }

    .score-average {
      background: #f97316;
      color: white;
    }

    .score-poor {
      background: #ef4444;
      color: white;
    }

    .no-scores {
      text-align: center;
      padding: 40px;
      color: var(--ink-2);
      font-size: 16px;
    }

    .poll-submissions {
      margin-top: 30px;
    }

    .poll-item {
      background: rgba(244, 211, 94, 0.2);
      border: 2px solid var(--yellow);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .poll-header {
      font-family: "Press Start 2P", monospace;
      font-size: 10px;
      color: var(--navy);
      margin-bottom: 10px;
    }

    .poll-teams {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      font-size: 12px;
    }

    .team-rank {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .rank-number {
      font-weight: bold;
      color: var(--navy);
      min-width: 20px;
    }

    @media (max-width: 768px) {
      .wrapper {
        padding: 10px;
      }

      .header h1 {
        font-size: 18px;
      }

      .stats-overview {
        grid-template-columns: 1fr;
      }

      .game-section {
        padding: 20px;
      }

      .scores-table {
        font-size: 12px;
      }

      .scores-table th,
      .scores-table td {
        padding: 8px 4px;
      }
    }
  </style>
</head>
<body>
  <!-- Include unified auth navigation bar -->
  {% include '_auth_navbar.html' %}
  
  <div class="wrapper">
    <!-- Header -->
    <div class="header">
      <h1>{{ user.username }}'s Game History</h1>
      <p>Track your performance across all Wheredhego games</p>
    </div>

    <!-- Stats Overview -->
    <div class="stats-overview">
      <div class="stat-card">
        <h3>Total Games</h3>
        <div class="stat-value">{{ stats.total_games or 0 }}</div>
        <p class="stat-label">Games Played</p>
      </div>
      <div class="stat-card">
        <h3>Average Score</h3>
        <div class="stat-value">{{ "%.1f"|format(stats.avg_score or 0) }}%</div>
        <p class="stat-label">Across All Games</p>
      </div>
      <div class="stat-card">
        <h3>Best Game</h3>
        <div class="stat-value">{{ stats.best_game or "N/A" }}</div>
        <p class="stat-label">Highest Scoring</p>
      </div>
      <!-- Creator Poll stats temporarily disabled -->
      <!--
      <div class="stat-card">
        <h3>Poll Submissions</h3>
        <div class="stat-value">{{ poll_count or 0 }}</div>
        <p class="stat-label">Creator Polls</p>
      </div>
      -->
    </div>

    <!-- Game Sections -->
    <div class="game-sections">
      
      <!-- Starting5 Scores -->
      <div class="game-section">
        <h2 class="game-title">
          <span class="game-icon">üèÄ</span>
          Starting5 Scores
        </h2>
        
        {% if starting5_scores %}
        <table class="scores-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Quiz</th>
              <th>Score</th>
              <th>Correct</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>
            {% for score in starting5_scores %}
            <tr>
              <td>{{ score.created_at.strftime('%m/%d/%y') }}</td>
              <td>{{ score.quiz_id.split('_')[0] if '_' in score.quiz_id else score.quiz_id }}</td>
              <td>
                {% set percentage = (score.score / score.max_points * 100) if score.max_points else 0 %}
                <span class="score-badge 
                  {% if percentage >= 90 %}score-excellent
                  {% elif percentage >= 70 %}score-good
                  {% elif percentage >= 50 %}score-average
                  {% else %}score-poor{% endif %}">
                  {{ "%.0f"|format(percentage) }}%
                </span>
              </td>
              <td>{{ score.score|int }}/{{ score.max_points|int if score.max_points else '?' }}</td>
              <td>{{ (score.time_taken // 60)|int }}:{{ "%02d"|format(score.time_taken % 60) if score.time_taken else '--' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="no-scores">
          <p>No Starting5 games played yet!</p>
          <p><a href="{{ url_for('starting5.show_quiz') }}">Play your first game ‚Üí</a></p>
        </div>
        {% endif %}
      </div>


      <!-- Skill Positions Scores -->
      <div class="game-section">
        <h2 class="game-title">
          <span class="game-icon">üèà</span>
          Skill Positions Scores
        </h2>
        
        {% if skill_positions_scores %}
        <table class="scores-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Quiz</th>
              <th>Score</th>
              <th>Correct</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>
            {% for score in skill_positions_scores %}
            <tr>
              <td>{{ score.created_at.strftime('%m/%d/%y') }}</td>
              <td>{{ score.quiz_id.split('_')[0] if '_' in score.quiz_id else score.quiz_id }}</td>
              <td>
                {% set percentage = (score.score / score.max_points * 100) if score.max_points else 0 %}
                <span class="score-badge 
                  {% if percentage >= 90 %}score-excellent
                  {% elif percentage >= 70 %}score-good
                  {% elif percentage >= 50 %}score-average
                  {% else %}score-poor{% endif %}">
                  {{ "%.0f"|format(percentage) }}%
                </span>
              </td>
              <td>{{ score.score|int }}/{{ score.max_points|int if score.max_points else 5 }}</td>
              <td>
                {% if score.time_taken %}
                  {{ "%.1f"|format(score.time_taken / 60) }}m
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="no-scores">
          <p>No Skill Positions games played yet!</p>
          <p><a href="{{ url_for('gridiron11.show_quiz') }}">Play your first game ‚Üí</a></p>
        </div>
        {% endif %}
      </div>

      <!-- Creator Poll Submissions - TEMPORARILY DISABLED -->
      <!--
      <div class="game-section">
        <h2 class="game-title">
          <span class="game-icon">üìä</span>
          Creator Poll Submissions
        </h2>
        
        {% if creatorpoll_scores %}
        <table class="scores-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Poll</th>
              <th>Teams Ranked</th>
              <th>Completion</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody>
            {% for score in creatorpoll_scores %}
            <tr>
              <td>{{ score.created_at.strftime('%m/%d/%y') }}</td>
              <td>
                {% if score.metadata and score.metadata.week_number %}
                Week {{ score.metadata.week_number }}, {{ score.metadata.season_year }}
                {% else %}
                {{ score.quiz_id.split('_')[1] if '_' in score.quiz_id else score.quiz_id }}
                {% endif %}
              </td>
              <td>{{ score.score|int }}/{{ score.max_points|int if score.max_points else 25 }}</td>
              <td>
                {% set percentage = (score.score / score.max_points * 100) if score.max_points else 0 %}
                <span class="score-badge 
                  {% if percentage >= 100 %}score-excellent
                  {% elif percentage >= 80 %}score-good
                  {% elif percentage >= 60 %}score-average
                  {% else %}score-poor{% endif %}">
                  {{ "%.0f"|format(percentage) }}%
                </span>
              </td>
              <td>
                {% if score.metadata and score.metadata.submission_type %}
                {{ score.metadata.submission_type.title() }}
                {% else %}
                Submission
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        
        {% if poll_submissions %}
        <div class="poll-submissions">
          <h3 style="font-family: 'Press Start 2P', monospace; font-size: 12px; margin: 20px 0 10px 0; color: var(--navy);">Recent Poll Details</h3>
          {% for submission in poll_submissions[:3] %}
          <div class="poll-item">
            <div class="poll-header">
              Week {{ submission.week_number }}, {{ submission.season_year }} - Submitted {{ submission.submitted_at.strftime('%m/%d/%y at %I:%M %p') }}
            </div>
            <div class="poll-teams">
              {% for team in submission.ballot_data[:10] %}
              <div class="team-rank">
                <span class="rank-number">{{ team.rank }}.</span>
                <span>{{ team.team_name }}</span>
              </div>
              {% endfor %}
              {% if submission.ballot_data|length > 10 %}
              <div class="team-rank">
                <span class="rank-number">...</span>
                <span>and {{ submission.ballot_data|length - 10 }} more teams</span>
              </div>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
        
        {% else %}
        <div class="no-scores">
          <p>No poll submissions yet!</p>
          <p>Creator poll functionality disabled</p>
        </div>
        {% endif %}
      </div>
      -->

    </div>
  </div>
</body>
</html>
